<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Admin — Editor de Cardápio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <style>
    :root{--bg:#0f1115;--surface:#151924;--muted:#23293a;--muted-2:#1b2030;--text:#e8eaf1;--text-2:#9aa4bd;--primary:#5b8cff;--danger:#ff5b74;--ok:#3ecf8e;--warn:#f7b955;--border:#2a3146;--shadow:0 8px 24px rgba(0,0,0,.35)}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .topbar{position:sticky;top:0;z-index:10;display:flex;gap:8px;align-items:center;padding:12px 16px;background:linear-gradient(180deg,rgba(21,25,36,.98),rgba(21,25,36,.92));border-bottom:1px solid var(--border)}
    .topbar .title{font-weight:600;margin-right:12px}
    .btn{padding:8px 12px;border:1px solid var(--border);background:var(--muted);color:var(--text);border-radius:8px;cursor:pointer}
    .btn.primary{background:var(--primary);border-color:#3e6ef5;color:#fff}.btn.ok{background:var(--ok);border-color:#26b874;color:#08130f}.btn.warn{background:var(--warn);border-color:#d79a1e;color:#1c1405}.btn.danger{background:var(--danger);border-color:#db3b57}.btn:disabled{opacity:.5;cursor:not-allowed}
    .spacer{flex:1}.seg{display:flex;gap:8px}.filters{display:flex;gap:8px;align-items:center;margin-left:8px}
    .select,.input{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:var(--muted-2);color:var(--text)}
    .wrap{display:flex;height:calc(100% - 56px)}.list{flex:1;padding:12px 16px;overflow:auto}
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}.thead{color:var(--text-2);font-size:12px;text-transform:uppercase;letter-spacing:.06em}
    .row{background:var(--surface);border:1px solid var(--border);box-shadow:var(--shadow);border-radius:10px}.row td{padding:10px 12px;vertical-align:middle}.row .type{font-weight:600}
    .badge{padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:var(--muted-2);color:var(--text-2)}.row.selected{outline:2px solid var(--primary)}.draghandle{cursor:grab;opacity:.7}
    .status-Disponível{color:#85ffa8}.status-Oculto{color:#ffc46c}.status-Indisponível{color:#ff8080}
    .drawer{width:0;max-width:560px;background:var(--surface);border-left:1px solid var(--border);box-shadow:var(--shadow);transition:width .2s ease;overflow:hidden;display:flex;flex-direction:column}
    .drawer.open{width:min(100%,520px)}.drawer-header{display:flex;align-items:center;gap:8px;padding:14px 16px;border-bottom:1px solid var(--border)}
    .tabs{display:flex;gap:6px}.tab{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:var(--muted-2);cursor:pointer}.tab.active{background:var(--primary);color:#fff;border-color:#3e6ef5}
    .drawer-body{padding:16px;overflow:auto}.field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}.label{font-size:12px;color:var(--text-2)}
    .input,.select,textarea{width:100%}textarea{min-height:80px;resize:vertical}.chips{display:flex;flex-wrap:wrap;gap:6px}.chip{background:var(--muted-2);border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:999px}
    .drawer-footer{display:flex;gap:8px;padding:12px 16px;border-top:1px solid var(--border)}.hint{color:var(--text-2);font-size:12px}
    .img-preview{width:100%;max-height:180px;object-fit:cover;border:1px solid var(--border);border-radius:8px;display:none}
    .toast{position:fixed;right:16px;bottom:16px;background:#111;border:1px solid var(--border);padding:10px 12px;border-radius:8px;box-shadow:var(--shadow);display:none;z-index:20}
    .toast.show{display:block}.reorder-active .draghandle{opacity:1}.drag-ghost{opacity:.4}
  </style>

  <!-- DEDUPE INLINE: remove botões Painel/Cardápio fora do nosso topbar -->
  <script>
    (function(){
      function isInsideAdminTopbar(el){
        while(el){ if(el.id==='adminTopbar') return true; el = el.parentElement; }
        return false;
      }
      function dedupe(){
        var labels = ['painel','cardápio','cardapio'];
        var btns = Array.from(document.querySelectorAll('button'));
        var byLabel = btns.filter(b => labels.includes((b.textContent||'').trim().toLowerCase()));
        // mantém só se estiver no #adminTopbar
        byLabel.forEach(b=>{
          if(!isInsideAdminTopbar(b)) b.remove();
        });
      }
      document.addEventListener('DOMContentLoaded', dedupe);
    })();
  </script>
</head>
<body>
  <div class="topbar" id="adminTopbar" data-v="admin-2025-09-17-2015">
    <div class="title">Editor de Cardápio</div>
    <div class="seg">
      <button class="btn" id="btnAdd">Adicionar</button>
      <button class="btn" id="btnEdit" disabled>Editar</button>
      <button class="btn danger" id="btnDelete" disabled>Excluir</button>
      <button class="btn" id="btnDuplicate" disabled>Duplicar</button>
      <button class="btn warn" id="btnReorder">Reordenar</button>
      <button class="btn ok" id="btnPublish">Publicar</button>
    </div>
    <div class="spacer"></div>
    <div class="filters">
      <select class="select" id="filterType">
        <option value="all">Todos</option>
        <option value="item">Itens</option>
        <option value="categoria">Categorias</option>
      </select>
      <input class="input" id="search" placeholder="Buscar por nome/tag..." />
    </div>
  </div>

  <div class="wrap">
    <div class="list">
      <table class="table" id="grid">
        <thead class="thead">
          <tr><th style="width:28px;"></th><th>Tipo</th><th>Nome</th><th>Categoria</th><th>Preço</th><th>Status</th><th>Ordem</th></tr>
        </thead>
        <tbody id="gridBody"></tbody>
      </table>
      <div class="hint">Atalhos: N/E/D/Del/R/P, Esc, Ctrl+S, Ctrl+Enter.</div>
    </div>

    <aside class="drawer" id="drawer">
      <div class="drawer-header">
        <div class="tabs">
          <button class="tab active" data-tab="item">Item</button>
          <button class="tab" data-tab="categoria">Categoria</button>
        </div>
        <div class="spacer"></div>
        <button class="btn" id="btnCloseDrawer">Fechar (Esc)</button>
      </div>
      <div class="drawer-body">
        <form id="formItem" data-kind="item">
          <div class="field"><div class="label">Nome *</div><input class="input" id="it_nome" autocomplete="off" /></div>
          <div class="field"><div class="label">Categoria *</div><div style="display:flex;gap:8px"><select class="select" id="it_categoria"></select><button class="btn" id="btnNewCatInline" type="button">+ criar</button></div></div>
          <div class="field"><div class="label">Preço (R$)</div><input class="input" id="it_preco" type="number" step="0.01" min="0" /></div>
          <div class="field"><div class="label">Status</div><select class="select" id="it_status"><option>Disponível</option><option>Oculto</option><option>Indisponível</option></select></div>
          <div class="field"><div class="label">Descrição</div><textarea id="it_desc" class="input" placeholder="Detalhes do item..."></textarea></div>
          <div class="field"><div class="label">Imagem (URL)</div><input class="input" id="it_img" placeholder="https://..." /><img id="it_img_prev" class="img-preview" alt="preview"/></div>
          <div class="field"><div class="label">Tags (vírgula)</div><input class="input" id="it_tags" placeholder="vegano, sem-glúten" /><div id="it_tags_preview" class="chips"></div></div>
          <div class="field"><div class="label">Ordem</div><input class="input" id="it_ordem" type="number" step="1" /></div>
        </form>

        <form id="formCategoria" data-kind="categoria" style="display:none">
          <div class="field"><div class="label">Nome *</div><input class="input" id="cat_nome" autocomplete="off" /></div>
          <div class="field"><div class="label">Status</div><select class="select" id="cat_status"><option>Ativa</option><option>Oculta</option></select></div>
          <div class="field"><div class="label">Ordem</div><input class="input" id="cat_ordem" type="number" step="1" /></div>
        </form>
      </div>
      <div class="drawer-footer">
        <button class="btn" id="btnSalvar">Salvar (Ctrl+S)</button>
        <button class="btn primary" id="btnSalvarContinuar">Salvar e continuar (Ctrl+Enter)</button>
        <div class="spacer"></div>
        <div class="hint" id="dirtyHint" style="display:none">Alterações não publicadas</div>
      </div>
    </aside>
  </div>

  <!-- cache-bust na importação do JS -->
  <script src="/static/admin.js?v=20250917-212445"></script>
</body>
</html>




